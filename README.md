# TaskandReward

一个用于记录每日任务完成情况并积累奖励额度的微信小程序，帮助用户量化自律成果并兑换心仪奖励。

## 小程序码

欢迎👏大家来试用啊！

![miniprogram_code.jpg]


## 核心功能

### 1. 任务管理

- **任务 CRUD**：支持新增、编辑、删除任务
- **任务配置**：
  - 任务名称、描述
  - 奖励额度（完成任务获得的奖励点数）
  - 重复频率：自定义、每日、每周、每月
- **任务打卡**：
  - 支持任务完成打卡，自动记录完成时间和奖励
  - 支持取消打卡（撤销当日的完成记录）
  - 自定义任务完成后可恢复，重新出现在今日任务列表
- **今日任务自动管理**：
  - 每日任务：每天自动出现在今日任务列表
  - 每周任务：周一自动出现，本周完成后不再显示，下周重新出现
  - 每月任务：每月 1 号自动出现，本月完成后不再显示，下月重新显示
  - 自定义任务：创建后每天显示，完成后消失，可通过恢复按钮重新出现
- **任务排序**：
  - 任务列表默认按创建时间倒序排列（最新在前）
  - 今日任务列表支持拖拽排序，顺序会保存
  - 任务列表支持拖拽排序
- **任务搜索**：任务列表支持按标题和描述搜索
- **任务恢复**：
  - 自定义任务完成后可恢复，重新出现在今日任务列表
  - 恢复任务会生成"再次开启"日志记录
  - 支持撤销恢复操作

### 2. 奖励池管理

- **奖励项目 CRUD**：支持新增、编辑、删除奖励项目
- **奖励配置**：
  - 奖励名称、补充说明
  - 目标额度（兑换该奖励所需的奖励点数）
- **奖励进度**：
  - 实时显示当前可用奖励与目标额度的比例
  - 使用进度条可视化显示完成进度
  - 当可用奖励达到目标时，可进行兑换
- **奖励状态**：
  - 积累中：可用奖励未达到目标
  - 可兑换：可用奖励已达到目标
  - 已兑换：奖励已被兑换（显示灰色背景和文字）
- **奖励排序**：奖励列表支持拖拽排序
- **奖励池展开/收起**：首页奖励池默认显示前 2 个，点击标题可展开/收起

### 3. 数据统计

- **奖励汇总**：
  - 累计奖励：所有任务完成获得的奖励总和
  - 已兑换：所有奖励兑换消耗的奖励总和
  - 当前可用：累计奖励 - 已兑换
- **历史记录**：
  - 按日期分组显示所有奖励获得和兑换记录
  - 显示每条记录的时间（小时:分钟）
  - 支持撤销历史记录（会同步更新任务状态和奖励状态）
  - 支持日期筛选：点击"历史记录"标题可选择日期
  - 支持标题搜索：输入关键词搜索记录标题
  - 支持时间/日期编辑：点击记录时间可修改日期和时间，修改后同步更新任务状态
  - 支持多条评论：每条记录可添加多条评论，显示评论时间和内容
  - 点击记录可跳转到统计页面并定位到该记录
- **数据管理**：支持清空所有数据（任务、奖励、历史记录）

### 4. 首页概览

- **可用奖励**：显示当前可用的奖励点数
- **今日任务**：
  - 显示今日需要完成的任务（圆形按钮）
  - 任务完成后显示绿色边框
  - 支持快速打卡
  - 横向滚动显示
- **任务进度**：灰色方块表示总任务数，绿色方块表示已完成任务数
- **奖励池预览**：
  - 默认显示前 2 个奖励项目
  - 点击标题可展开/收起
  - 点击奖励项可跳转到奖励页面
  - 包括进度条和兑换状态
- **今日记录**：显示今日的奖励获得和兑换记录，时间显示在标题右侧
- **昨日日志时间轴**：以时间轴形式显示昨日所有记录，时间显示在标题左侧
- **最近日志时间轴**：
  - 显示完整的 24 小时时间轴（00:00-23:00）
  - 支持日期筛选
  - 连续至少 3 小时无记录时自动折叠，点击开始时间可展开
  - 显示所有评论内容

## 页面结构

### 首页（Home）

- 可用奖励概览
- 今日任务列表（圆形按钮，横向滚动）
- 任务完成进度可视化
- 奖励池预览（默认前 2 个，可展开/收起）
- 今日记录（今日的奖励获得和兑换记录）
- 昨日日志时间轴（以时间轴形式显示昨日记录）
- 最近日志时间轴（24 小时完整时间轴，支持日期筛选和折叠）

### 任务页（Tasks）

- **添加/编辑任务表单**（可折叠，点击标题展开/收起）
  - 任务名称
  - 任务描述
  - 奖励额度
  - 重复频率（自定义、每日、每周、每月）
- **今日任务列表**
  - 显示今日需要完成的任务
  - 支持拖拽排序
  - 显示任务状态（待完成/今日已完成）
  - 支持打卡/取消打卡
  - 新添加的任务显示在已完成任务上方
  - 撤销的任务回到原位置
- **任务列表**
  - 显示所有任务，默认按创建时间倒序排列
  - 支持拖拽排序
  - 支持搜索（按标题和描述）
  - 已完成的自定义任务显示灰色背景和文字
  - 支持打卡、恢复（自定义任务）、编辑、删除操作

### 奖励页（Rewards）

- **奖励概览**：显示当前可用奖励
- **添加/编辑奖励表单**（可折叠，点击标题展开/收起）
  - 奖励名称
  - 目标额度
  - 补充说明
- **奖励池**
  - 显示所有奖励项目
  - 显示奖励状态（积累中/可兑换/已兑换）
  - 显示可用奖励/目标额度
  - 显示进度条
  - 已兑换的奖励显示灰色背景和文字
  - 支持兑换、编辑、删除操作
  - 支持拖拽排序

### 统计页（Stats）

- **奖励汇总**
  - 累计奖励
  - 已兑换
  - 当前可用
  - 清空数据库按钮
- **历史记录**
  - 按日期分组显示
  - 显示每日的奖励获得和兑换汇总
  - 每条记录显示时间（可点击编辑日期和时间）
  - 支持日期筛选（点击"历史记录"标题选择日期）
  - 支持标题搜索（输入关键词搜索）
  - 支持撤销操作（🔙 图标）
  - 支持评论功能（点击记录标题添加/编辑评论）
  - 每条记录可添加多条评论，显示评论时间和内容
  - 点击首页记录可跳转到统计页面并定位到该记录
  - 点击页面空白处可清除筛选条件

## 数据结构

### 任务（Task）

```javascript
{
  id: string,              // 任务ID
  title: string,           // 任务名称
  description: string,     // 任务描述
  rewardAmount: number,   // 奖励额度
  cycle: string,           // 重复频率：自定义、每日、每周、每月
  history: Array<{         // 完成历史
    id: string,
    date: string,          // 完成日期 YYYY-MM-DD
    amount: number         // 获得的奖励
  }>,
  lastCompletedDate: string, // 最后完成日期
  createdAt: number        // 创建时间戳
}
```

### 奖励（Reward）

```javascript
{
  id: string,              // 奖励ID
  name: string,            // 奖励名称
  targetAmount: number,   // 目标额度
  notes: string,           // 补充说明
  redeemedAt: string,      // 兑换日期（如果已兑换）
  createdAt: number        // 创建时间戳
}
```

### 日志（Log）

```javascript
{
  id: string,              // 日志ID
  type: string,            // 类型：earn（获得）、spend（兑换）或 restore（恢复任务）
  taskId: string,          // 任务ID（type为earn或restore时）
  taskTitle: string,       // 任务名称（type为earn或restore时）
  rewardId: string,        // 奖励ID（type为spend时）
  rewardName: string,      // 奖励名称（type为spend时）
  amount: number,          // 金额（restore类型为0）
  date: string,            // 日期 YYYY-MM-DD
  createdAt: number,       // 创建时间戳
  comments: Array<{        // 评论列表（可选）
    content: string,       // 评论内容
    createdAt: number,     // 评论创建时间戳
    time: string,          // 评论时间（HH:mm）
    dateTime: string       // 评论日期时间（YYYY-MM-DD HH:mm）
  }>
}
```

### 今日任务排序（TodayTasksOrder）

```javascript
Array<string>  // 任务ID数组，按显示顺序排列
```

### 任务列表排序（TasksOrder）

```javascript
Array<string>  // 任务ID数组，按拖拽排序后的顺序排列
```

## 技术实现

### 数据存储

- 使用微信小程序本地存储（`wx.setStorageSync` / `wx.getStorageSync`）
- 存储键：
  - `tasks`：任务列表
  - `rewards`：奖励列表
  - `logs`：历史记录
  - `todayTasksOrder`：今日任务排序
  - `tasksOrder`：任务列表排序
  - `targetLogId`：目标日志 ID（用于页面跳转定位）
  - `targetLogDate`：目标日志日期（用于页面跳转定位）

### 核心服务

- **storage.js**：数据存储工具函数
  - 任务、奖励、日志的增删改查
  - 奖励总额计算
  - 今日任务排序管理
  - 数据清空功能
- **taskService.js**：任务相关业务逻辑
  - `completeTask`：完成任务打卡
  - `cancelTask`：取消任务打卡

### UI/UX 特性

- **分享功能**：
  - 支持分享给好友/群聊（`onShareAppMessage`）
  - 支持分享到朋友圈（`onShareTimeline`）
  - 分享内容仅包含功能介绍，不包含用户个人数据
- **拖拽排序**：使用触摸事件实现任务和奖励列表的拖拽排序
- **可折叠表单**：添加/编辑表单支持展开/收起（点击标题切换）
- **搜索功能**：任务列表支持按标题和描述搜索
- **筛选功能**：历史记录支持日期筛选和标题搜索
- **时间轴显示**：
  - 昨日日志以时间轴形式显示
  - 最近日志显示完整的 24 小时时间轴
  - 连续空小时自动折叠，点击可展开
- **评论功能**：
  - 每条记录支持添加多条评论
  - 显示评论时间和内容
  - 点击记录标题可添加/编辑评论
- **时间编辑**：历史记录的时间可点击编辑，支持修改日期和时间
- **状态可视化**：
  - 已完成任务：绿色背景和边框
  - 已完成自定义任务：灰色背景和文字
  - 已兑换奖励：灰色背景和文字
- **图标按钮**：使用图标简化操作按钮（✓、✎、×、🔙、💬 等）
- **进度条**：使用原生 `<progress>` 组件显示奖励进度
- **页面跳转**：点击首页记录可跳转到统计页面并自动定位到该记录

## 开发说明

### 项目结构

```
miniprogram/reward/
├── miniprogram/
│   ├── app.js              # 全局应用逻辑
│   ├── app.json            # 全局配置（页面路径、tabBar等）
│   ├── app.wxss            # 全局样式
│   ├── pages/              # 页面目录
│   │   ├── index/          # 首页
│   │   ├── tasks/          # 任务页
│   │   ├── rewards/        # 奖励页
│   │   └── stats/         # 统计页
│   └── utils/              # 工具函数
│       ├── storage.js      # 数据存储
│       └── taskService.js  # 任务服务
└── README.md
```

### 运行要求

- 微信开发者工具
- 小程序基础库版本：建议 2.0.0+

### 主要依赖

- 无外部依赖，使用微信小程序原生 API

## 功能亮点

1. **智能任务管理**：根据任务周期自动管理今日任务列表，无需手动添加
2. **灵活的任务类型**：支持自定义、每日、每周、每月四种重复频率
3. **可视化进度**：通过进度条和任务方块直观显示完成情况
4. **数据可追溯**：完整的历史记录，支持撤销操作、时间编辑、评论功能
5. **便捷操作**：拖拽排序、图标按钮、可折叠表单、搜索筛选等提升用户体验
6. **状态区分**：通过颜色区分不同状态（已完成、已兑换等）
7. **时间轴展示**：24 小时完整时间轴，支持折叠和展开，直观展示每日活动
8. **分享功能**：支持分享给好友和朋友圈，方便推广小程序
9. **评论系统**：每条记录支持多条评论，记录更多细节和想法
10. **智能排序**：任务列表默认按创建时间倒序，支持拖拽自定义排序

## 未来优化方向

- [ ] 数据云同步（使用微信云开发）
- [ ] 任务提醒功能
- [ ] 数据导出/导入
- [ ] 更多统计图表（趋势图、饼图等）
- [ ] 任务分组/标签功能
- [ ] 奖励兑换记录详情
- [ ] 成就系统
- [ ] 数据备份与恢复
- [ ] 每项任务打卡图例
- [ ] 长期打卡图例

